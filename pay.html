
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Stripe Test - Split Checkout (Card Portion)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <h2>Paiement test (portion carte)</h2>
    <p>Carte test Stripe: <b>4242 4242 4242 4242</b>, date future, CVC 123.</p>
    <div>
      <label>Client Secret (auto depuis URL ?secret=...):</label><br>
      <input id="secret" placeholder="pi_xxx_secret_xxx" style="width:100%;max-width:600px;">
    </div>
    <div style="margin-top:10px;">
      <label>Stripe Publishable Key (auto depuis URL ?pk=...):</label><br>
      <input id="pk" placeholder="pk_test_xxx" style="width:100%;max-width:600px;">
    </div>
    <div id="card-element" style="margin:16px 0;"></div>
    <button id="pay">Payer maintenant</button>
    <pre id="out" style="margin-top:16px;background:#f7f7f7;padding:12px;white-space:pre-wrap;"></pre>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
      function getParam(name){
        const u = new URL(window.location.href);
        return u.searchParams.get(name);
      }
      const secretInput = document.getElementById('secret');
      const pkInput = document.getElementById('pk');
      const out = document.getElementById('out');
      secretInput.value = getParam('secret') || '';
      pkInput.value = getParam('pk') || '';

      let stripe, elements, card;
      function initStripe(){
        const pk = pkInput.value.trim();
        if(!pk){ out.textContent = "⚠️ Entre ta clé Stripe publishable (pk_test_...)"; return; }
        stripe = Stripe(pk);
        elements = stripe.elements();
        card = elements.create('card');
        card.mount('#card-element');
        out.textContent = "✅ Stripe initialisé. Entre le client secret puis clique Payer.";
      }
      initStripe();

      document.getElementById('pay').onclick = async () => {
        try{
          const secret = secretInput.value.trim();
          if(!secret){ out.textContent = "⚠️ Entre un client_secret Stripe."; return; }
          const {paymentIntent, error} = await stripe.confirmCardPayment(secret, {
            payment_method: { card }
          });
          if(error){
            out.textContent = "❌ " + error.message;
          } else {
            out.textContent = "✅ Statut: " + paymentIntent.status + "\nPaymentIntent ID: " + paymentIntent.id;
          }
        }catch(e){
          out.textContent = "❌ " + (e.message || e);
        }
      };
    </script>
  </body>
</html>
